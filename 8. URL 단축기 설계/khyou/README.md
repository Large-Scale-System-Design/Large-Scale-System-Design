# 1단계 문제 이해 및 설계 범위 확정
- 트래픽 규모는? -> 매일 1억개의 단축 URL을 만들 수 있어야 한다.
- 단축 URL의 길이는? -> 짧을 수록 좋다.
- 단축 URL에 포함될 문자에 제한이 있는지? -> 숫자와 영문자만 가능하다.
- 단축된 URL을 시스템에서 지우거나 갱신할 수 있는지? -> 시스템을 단순화하기 위한 삭제나 변경은 없다.

# 2단계 개략적 설계안 제시 및 동의 구하기
## API 엔드포인트
### 1. URL 단축용 엔드포인트
- 클라이언트이 단축시키고자 하는 URL을 넘기면 단축된 URL을 반환하는 API
### 2. URL 리디렉션용 엔드포인트
- 단축 URL에 대해서 HTTP 요청이 오면 원래 URL로 보내주기 위한 용도의 엔드포인트

## URL 리디렉션
리디렉션용 엔드포인트로 요청이 오면 서버는 원래 긴 URL로 리다이렉션을 시켜준다. 리다이렉션 HTTP 상태 코드 별 로직을 살펴보자.

### 301
- 이 응답은 해당 URL에 대한 HTTP 요청이 처리 책임이 영구적으로 Location 헤더에 반환된 URL로 이전되었다는 응답이다.
- 따라서 브라우저는 캐시에 URL을 저장해두고, 클라이언트가 단축 URL을 입력하면 서버로 요청하지 않고 캐시에 저장된 URL로 이동시킨다.
- 서버 부하를 줄이고자 하면 301을 사용

### 302
- 이 응답은 주어진 URL로의 요청이 '일시적으로' Location 헤덩가 지정하는 URL에 의해 처리되어야 한다는 응답이다.
- 따라서 클라이언트가 단축 URL을 입력하면 서버로 요청이 오고 서버가 매번 Redirect 응답을 주어야 한다.
- 트래픽 분석이 중요하면 302 사용

## URL 단축
- URL을 해시 해서 해시 값을 KEY로, URL을 VALUE로 하는 해시 맵을 사용하여 데이터 관리 가능 

# 3단계 상세 설계
## 해시 사용 방법
- 해시 값을 PK로(또는 UNIQUE), URL을 컬럼으로 갖는 RDBMS 테이블을 만들어서 관리한다.
- 해시 값 길이를 정하는 방법은 다음과 같다.
	- 문자 + 숫자개수는 총 62개이다. 따라서 hashValue의 길이를 정하려면 62^n >= 3650억 이어야 한다.
	- n = 7 이면 3.5조개의 URL을 만들 수 있다.
	- 해시 함수 (ex. SHA-1, MD5)를 이용하여 URL을 해시하고 앞 7자리를 사용한다.
- 해시 7자리를 사용하면 충돌 가능성이 높다. 따라서 해시 7자리가 DB에 있는 지 확인하고 있으면 longURL 뒤에 사전에 정한 문자열을 추가하고 다시 해시하는 방법을 사용하여 문제를 해결할 수 있다.

## Base-62 변환
- 62진법을 활용하는 방법
- longURL이 입력되면 숫자로된 고유한 ID를 만든다.
	- 7장에서 학습한 Snowflake 기법 활용
	- Base-62로 인코딩 시 7자리 이하가 되려면 ID는 최대 62^7 - 1 까지만 만들어야 한다.
- 고유한 ID를 Base-62로 변환하여 shortURL을 만든다.
- ID, shortURL, longURL을 DB에 저장한다.
- shortURL을 반환한다.

# URL 리디렉션 상세 설계

쓰기 작업 보다 읽기 작업이 월등히 많기 때문에 캐시를 사용하면 성능을 향상시킬 수 있다.
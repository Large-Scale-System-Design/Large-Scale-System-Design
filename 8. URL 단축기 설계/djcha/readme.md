## 9주차. URL 단축기 설계

1. URL 단축기
    - 2개의 엔드포인트
        - URL 단축용 엔드포인트: 새 단축 URL을 생성하기 위해 POST 요청을 보내는 엔드포인트
            - POST /api/v1/data/shorten -d { “url”: “longUrl” }
        - URL 리디렉션용 엔드포인트: 단축 URL에 대해서 HTTP 요청이 오면 원래 URL로 보내주기 위한 용도의 엔드포인트
            - GET /api/v1/shortUrl → 301 or 302 /api/v1/longUrl
            - 301 응답 시: 영구이전 → 클라이언트 브라우저가 값을 캐시하여, 다음 요청부터 바로 단축서버가 아니라 대상서버로 요청
                - 서버에 부하가 줄어듬
            - 302 응답 시: 임시이전 → 항상 단축기 서버로 요청 보내서 값을 받아오고, 그 값을 기준으로 서버에 다시 요청
                - 트래픽 분석에 용이함

    - 구현 방법
        - 해시 테이블에 <단축URL, 원래URL> 쌍으로 저장
        - URL 단축용 해시 함수 조건
            - URL이 다르면 해시 값도 달라야함 (1:1)
            - 복원이 가능해야 함

    - 해시값
        - 0~9, a-z, A-Z 의 총 62개 문자
        - N자리 단축 URL 문자열 = 62의 N제곱개의 단축 URL을 생성할 수 있음
            - N=7일 경우, 약 3.5조개의 URL 생성 가능

    - 해시 함수 구현 방법
        - 해시 후 충돌 해소
            - 해시 값 생성 → 해시값 앞에 N자리만 사용 → DB에 있는지 중복 확인 → 중복있으면 다시 만들기 (오버헤드가 큼)
        - base-62 변환
            - 62진법 변환
            - 유일성 보장 ID 를 부여 → ID를 62진법 변환(11157 → 2TX)

    - <단축 URL, 원래URL> 쌍을 캐싱하여 성능적으로 보완

<br>

<br>

* * *

twitter의 snowflake 방식을 이용한 URL ID를 부여하고, 단축 URL 을 62진법으로 나타내기
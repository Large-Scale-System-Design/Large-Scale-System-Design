## 9주차. 분산 시스템을 위한 유일 ID 생성기 설계 

<br>

1. 분산시스템에서 유일성이 보장되는 ID를 만드는 방법
    - 다중 마스터 복제
        - 데이터베이스의 auto\_increment 기능을 활용
        - ID의 값을 k 만큼 증가 (k는 분산형 DB에서의 DB 개수)
            - 서버1: 1, 3, 5, 7
            - 서버2: 2, 4, 6, 8
        - 단점
            - 여러 데이터 센터에 걸쳐 규모를 늘리기 어려움
            - ID 유일성은 보장되지만, 그 값이 시간에 흐름에 맞추어 커지도록 보장할 수 없음
            - 서버를 추가하거나 삭제할 때도 잘 동작하도록 만들기 어려움

    - UUID
        - 유일하게 식별하기 위한 128비트(16바이트) 수
        - 충돌 가능성이 지극히 낮음 
        - 중복 UUID 가 1개 생길 확률을 50%로 끌어올리려면 초당 10억개의 UUID를 100년동안 계속 만들어야 함
        - 서버간 조율 없이 독립적으로 생성 가능
        - 장점
            - 간단함
            - 서버 사이의 조율이 필요가 없음
            - 규모 확장에 용이
        - 단점
            - 길다(16바이트)
            - ID를 시간 순으로 정렬할 수 없음
            - ID에 숫자가 아닌 값이 포함될 수 있음

    - 티켓 서버
        - 중앙 티켓 서버에서만 auto\_increment 키를 발급해주는 구조
        - 장점
            - 유일성이 보장되는 숫자로만 구성된 ID를 쉽게 만들 수 있음
            - 구현하기 쉽고, 중소 규모 애플리케이션에 적합
        - 단점
            - 티켓 서버가 SPOF가 될 수 있음
            - 티켓 서버에 장애가 발생할 경우, 해당 서버를 이용하는 모든 시스템에 영향이 생김
                - 이 이슈를 피하기 위해 티켓 서버를 분산하면, 배보다 배꼽이 더 큰 격
                - 티켓 서버 간에 데이터 동기화 같은 문제가 생길 수 있음

    - 트위터 snowflake 접근법
        - divde and conquer 전략
        - 생성해야 하는 ID의 구조를 여러 절로 분할
            - Sign(1비트): 양수 / 음수 구분
            - Timestamp(41비트): 기원시각 이후 몇 밀리초가 경과했는지
            - 데이터센터ID(5비트): 2^5 = 32 → 32개의 데이터센터를 지원할 수 있음
            - 서버ID(5비트): 2^5 = 32 → 32개의 서버를 지원할 수 있음
            - 일련번호(12비트): 각 서버에서 ID를 생성할 때마다 일련 번호를 1만큼 증가 + 1밀리초가 증가할때마다 0으로 초기화
            - 69년동안 1024개의 서버가 동일한 밀리초에 4096개 안쪽으로 데이터를 생설할 때 유일성을 보장

<br>